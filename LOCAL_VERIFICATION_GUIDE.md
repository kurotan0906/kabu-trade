# Phase 1 ローカル動作確認ガイド

このガイドでは、Phase 1の機能をローカル環境で実際に起動し、ブラウザで動作確認する手順を説明します。

## 前提条件

- Python 3.11以上
- Node.js 18以上
- Docker & Docker Compose（データベース用）

## クイックスタート

### 方法1: 自動セットアップ（推奨）

```bash
# 1. セットアップを実行（初回のみ）
./scripts/setup_local.sh

# 2. アプリケーションを起動
./scripts/start_dev.sh
```

### 方法2: 手動セットアップ

詳細は [SETUP.md](./SETUP.md) を参照してください。

## ステップバイステップ手順

### ステップ1: セットアップ実行

```bash
./scripts/setup_local.sh
```

**確認ポイント:**
- [ ] Python、Node.js、Dockerが正しく検出された
- [ ] バックエンドの依存関係がインストールされた
- [ ] フロントエンドの依存関係がインストールされた
- [ ] .envファイルが作成された（`USE_MOCK_PROVIDER=true`が設定されている）

### ステップ2: データベース初期化

```bash
./scripts/init_db.sh
```

**確認ポイント:**
- [ ] PostgreSQLが起動した
- [ ] Redisが起動した
- [ ] データベースマイグレーションが正常に完了した

### ステップ3: アプリケーション起動

```bash
./scripts/start_dev.sh
```

または、個別に起動する場合：

```bash
# ターミナル1: バックエンド
./scripts/start_backend.sh

# ターミナル2: フロントエンド
./scripts/start_frontend.sh
```

**確認ポイント:**
- [ ] バックエンドが `http://localhost:8000` で起動した
- [ ] フロントエンドが `http://localhost:5173` で起動した
- [ ] エラーメッセージが表示されていない

### ステップ4: バックエンドAPIの確認

#### 4.1 ヘルスチェック

ブラウザで以下のURLにアクセス：
```
http://localhost:8000/health
```

**期待される結果:**
```json
{"status": "healthy"}
```

#### 4.2 APIドキュメントの確認

ブラウザで以下のURLにアクセス：
```
http://localhost:8000/docs
```

**確認ポイント:**
- [ ] Swagger UIが表示される
- [ ] `/api/v1/stocks/{code}` エンドポイントが表示される
- [ ] `/api/v1/stocks/{code}/prices` エンドポイントが表示される

#### 4.3 API動作確認（オプション）

ターミナルで以下を実行：

```bash
# 銘柄情報取得（モックデータ）
curl http://localhost:8000/api/v1/stocks/7203

# 株価データ取得（モックデータ）
curl http://localhost:8000/api/v1/stocks/7203/prices?period=1y
```

**期待される結果:**
- 銘柄情報（トヨタ自動車）が返される
- 株価データのリストが返される

### ステップ5: フロントエンドの確認

#### 5.1 ホームページの確認

ブラウザで以下のURLにアクセス：
```
http://localhost:5173
```

**確認ポイント:**
- [ ] 「Kabu Trade」のタイトルが表示される
- [ ] 銘柄コード入力フォームが表示される
- [ ] エラーメッセージが表示されていない

#### 5.2 銘柄検索の確認

1. 銘柄コード入力欄に `7203` を入力
2. 「検索」ボタンをクリック

**確認ポイント:**
- [ ] ページが遷移する（`/stocks/7203`）
- [ ] ローディング表示が表示される（一瞬）
- [ ] 銘柄情報が表示される
  - [ ] 銘柄名: 「トヨタ自動車」
  - [ ] 銘柄コード: 「7203」
  - [ ] 現在の株価が表示される

#### 5.3 チャート表示の確認

銘柄詳細ページで以下を確認：

**確認ポイント:**
- [ ] 期間選択ボタンが表示される（1日、1週間、1ヶ月、3ヶ月、6ヶ月、1年）
- [ ] チャートが表示される
- [ ] チャートに株価の折れ線が表示される
- [ ] 期間を変更するとチャートが更新される

#### 5.4 複数銘柄の確認

以下の銘柄コードでも同様に確認：

- `6758` - ソニーグループ
- `9984` - ソフトバンクグループ

**確認ポイント:**
- [ ] 各銘柄で正しい情報が表示される
- [ ] チャートが正しく表示される

### ステップ6: エラーハンドリングの確認

#### 6.1 存在しない銘柄コード

1. 銘柄コード入力欄に `9999` を入力
2. 「検索」ボタンをクリック

**期待される動作:**
- [ ] エラーメッセージが表示される
- [ ] 「銘柄コード 9999 が見つかりません」などのメッセージ

#### 6.2 ネットワークエラーの確認

バックエンドを停止して、フロントエンドからアクセス：

```bash
# バックエンドを停止（Ctrl+C）
# フロントエンドから銘柄検索を実行
```

**期待される動作:**
- [ ] エラーメッセージが表示される
- [ ] 「接続エラー」などのメッセージ

## 動作確認チェックリスト

### 基本機能
- [ ] ホームページが表示される
- [ ] 銘柄検索が動作する
- [ ] 銘柄情報が表示される
- [ ] チャートが表示される
- [ ] 期間選択が動作する

### モックデータ
- [ ] 7203（トヨタ自動車）が表示される
- [ ] 6758（ソニーグループ）が表示される
- [ ] 9984（ソフトバンクグループ）が表示される

### エラーハンドリング
- [ ] 存在しない銘柄コードでエラーが表示される
- [ ] エラーメッセージが分かりやすい

### API
- [ ] ヘルスチェックが動作する
- [ ] APIドキュメントが表示される
- [ ] 銘柄情報取得APIが動作する
- [ ] 株価データ取得APIが動作する

## トラブルシューティング

### バックエンドが起動しない

```bash
# 仮想環境が有効化されているか確認
cd backend
source venv/bin/activate

# 依存関係がインストールされているか確認
pip list | grep fastapi

# 環境変数ファイルが存在するか確認
ls -la .env
```

### フロントエンドが起動しない

```bash
# 依存関係がインストールされているか確認
cd frontend
ls -la node_modules

# 再インストール
rm -rf node_modules package-lock.json
npm install
```

### データベース接続エラー

```bash
# Dockerコンテナの状態確認
docker compose ps

# ログ確認
docker compose logs postgres
docker compose logs redis

# 再起動
docker compose restart postgres redis
```

### チャートが表示されない

- ブラウザのコンソールでエラーを確認
- ネットワークタブでAPIリクエストが成功しているか確認
- バックエンドのログを確認

## 次のステップ

動作確認が完了したら：

1. **Phase 2の動作確認**: 評価機能の動作確認
2. **kabuステーションAPIの設定**: 実際のAPIを使用する場合
3. **本番デプロイ**: AWS環境へのデプロイ

詳細は各ドキュメントを参照してください。
